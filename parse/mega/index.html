<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Table Parser to CSV and Excel</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.0/xlsx.full.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; line-height: 1.6; padding: 20px; }
        h1 { color: #333; }
        #csvOutput { width: 100%; height: 200px; margin-top: 20px; }
        button { background-color: #4CAF50; color: white; padding: 10px 20px; border: none; cursor: pointer; margin-top: 10px; margin-right: 10px; }
        button:hover { background-color: #45a049; }
    </style>
</head>
<body>
    <p>Paste your HTML content below:</p>
    <textarea id="htmlInput" rows="10" cols="100"></textarea>
    <br>
    <button onclick="parseTable()">Parse Table</button>
    <br>
    <textarea id="csvOutput" readonly></textarea>
    <br>
    <button onclick="downloadCSV()">Download CSV</button>
    <button onclick="downloadExcel()">Download Excel</button>

    <script>
        let parsedData = [];

        function parseScore(scoreText) {
            const match = scoreText.match(/(\d+(?:\.\d+)?)/);
            return match ? parseFloat(match[1]) : '';
        }

        function parseTable() {
            const htmlContent = document.getElementById('htmlInput').value;
            const parser = new DOMParser();
            const doc = parser.parseFromString(htmlContent, 'text/html');
            const table = doc.querySelector('.tbl01');
            
            if (!table) {
                alert('No table with class "tbl01" found in the input HTML.');
                return;
            }

            const rows = table.querySelectorAll('tbody tr');
            parsedData = [];

            rows.forEach(row => {
                const rowData = [];
                const cells = row.querySelectorAll('th, td');
                
                // 등수
                rowData.push(cells[0].textContent.trim());
                
                // 종합점수
                rowData.push(parseScore(cells[1].textContent));
                
                // LEET 백분위점수
                rowData.push(parseScore(cells[2].textContent));
                
                // 공인영어 점수와 종류
                const englishScoreText = cells[3].textContent.trim();
                const englishMatch = englishScoreText.match(/(\d+\.?\d*)점\s*\(\s*(.*?)\s*\)/);
                if (englishMatch) {
                    rowData.push(parseFloat(englishMatch[1])); // 점수
                    rowData.push(englishMatch[2]); // 종류
                } else {
                    rowData.push('');
                    rowData.push('');
                }
                
                // GPA
                rowData.push(parseScore(cells[4].textContent));
                
                // 서류
                rowData.push(cells[5].textContent.trim().replace(/\s+/g, ' '));
                
                // 출신대학, 자교/타교, 출신대학 등수
                const univText = cells[6].textContent.trim();
                const univMatch = univText.match(/(.*?)\s*\(\s*(자교|타교)(\d+)등\s*\)/);
                if (univMatch) {
                    rowData.push(univMatch[1]); // 출신대학
                    rowData.push(univMatch[2]); // 자교/타교
                    rowData.push(univMatch[3]); // 출신대학 등수
                } else {
                    rowData.push(univText);
                    rowData.push('');
                    rowData.push('');
                }
                
                // 전공, 법학/비법학, 전공 등수
                const majorText = cells[7].textContent.trim();
                const majorMatch = majorText.match(/(.*?)\s*\(\s*(법학|비법학)(\d+)등\s*\)/);
                if (majorMatch) {
                    rowData.push(majorMatch[1]); // 전공
                    rowData.push(majorMatch[2]); // 법학/비법학
                    rowData.push(majorMatch[3]); // 전공 등수
                } else {
                    rowData.push(majorText);
                    rowData.push('');
                    rowData.push('');
                }
                
                // 나이
                rowData.push(cells[8].textContent.trim());
                
                // 타군 지원 대학과 전형
                const otherAppText = cells[9].textContent.trim();
                const otherAppMatch = otherAppText.match(/(.*?)\s*\(\s*(.*?)\s*\)/);
                if (otherAppMatch) {
                    rowData.push(otherAppMatch[1]); // 타군 지원 대학
                    rowData.push(otherAppMatch[2]); // 타군 지원 전형
                } else {
                    rowData.push(otherAppText);
                    rowData.push('');
                }
                
                parsedData.push(rowData);
            });

            const csv = Papa.unparse({
                fields: ['등수', '종합점수', 'LEET 백분위점수', '공인영어 점수', '공인영어 종류', 'GPA', '서류', '출신대학', '자교/타교', '출신대학 등수', '전공', '법학/비법학', '전공 등수', '나이', '타군 지원 대학', '타군 지원 전형'],
                data: parsedData
            });

            document.getElementById('csvOutput').value = csv;
        }

        function downloadCSV() {
            const csv = document.getElementById('csvOutput').value;
            if (!csv) {
                alert('Please parse the table first.');
                return;
            }

            // UTF-8 BOM
            const BOM = "\uFEFF";
            const csvWithBOM = BOM + csv;

            const blob = new Blob([csvWithBOM], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            if (navigator.msSaveBlob) {
                navigator.msSaveBlob(blob, 'table_data.csv');
            } else {
                link.href = URL.createObjectURL(blob);
                link.download = 'table_data.csv';
                link.click();
            }
        }

        function downloadExcel() {
            if (parsedData.length === 0) {
                alert('Please parse the table first.');
                return;
            }

            const ws = XLSX.utils.aoa_to_sheet([
                ['등수', '종합점수', 'LEET 백분위점수', '공인영어 점수', 
                '공인영어 종류', 'GPA', '서류', 
                '출신대학', '자교/타교',  '자교/타교 등수', 
                '전공계열', '법학/비법학', '법학/비법학 등수', 
                '나이', '타군 지원 대학', '타군 지원 전형'],
                ...parsedData
            ]);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "Sheet1");
            
            XLSX.writeFile(wb, 'table_data.xlsx');
        }
    </script>
</body>
</html>